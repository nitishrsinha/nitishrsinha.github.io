<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCI-G Interactive Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-style: italic;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .control-group {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
        }
        .control-group h3 {
            margin: 0 0 15px 0;
            color: #34495e;
            font-size: 16px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
        }
        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
        }
        .input-group input:focus {
            outline: none;
            border-color: #3498db;
        }
        .forecast-controls {
            background-color: #e8f5e8;
            border: 2px solid #27ae60;
        }
        .forecast-controls h3 {
            color: #27ae60;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .reset-btn {
            background-color: #e74c3c;
        }
        .reset-btn:hover {
            background-color: #c0392b;
        }
        .info-panel {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        .error {
            background-color: #fcf8f8;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            color: #c0392b;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FCI-G Interactive Calculator</h1>
        <p class="subtitle">Financial Conditions Impulse on Growth - Roll Your Own Index</p>
        
        <div class="info-panel">
            <p><strong>About FCI-G:</strong> The Financial Conditions Impulse on Growth index measures how changes in financial conditions affect GDP growth. Positive values indicate headwinds to growth, negative values indicate tailwinds.</p>
        </div>

        <div id="loading" class="loading">
            Loading historical FCI-G data...
        </div>

        <div id="error" class="error" style="display: none;">
            <p><strong>Error:</strong> Unable to load FCI-G data. Please check your internet connection.</p>
        </div>

        <div id="main-content" style="display: none;">
            <div class="chart-container">
                <canvas id="fciChart"></canvas>
            </div>

            <div class="controls">
                <div class="control-group">
                    <h3>Federal Funds Rate (FFR)</h3>
                    <div class="input-group">
                        <label for="ffr-change">3-Month Change (%)</label>
                        <input type="number" id="ffr-change" step="0.01" value="0" placeholder="Enter change in basis points">
                    </div>
                </div>

                <div class="control-group">
                    <h3>10-Year Treasury Yield</h3>
                    <div class="input-group">
                        <label for="treasury-change">3-Month Change (%)</label>
                        <input type="number" id="treasury-change" step="0.01" value="0" placeholder="Enter change in basis points">
                    </div>
                </div>

                <div class="control-group">
                    <h3>30-Year Fixed Mortgage Rate</h3>
                    <div class="input-group">
                        <label for="mortgage-change">3-Month Change (%)</label>
                        <input type="number" id="mortgage-change" step="0.01" value="0" placeholder="Enter change in basis points">
                    </div>
                </div>

                <div class="control-group">
                    <h3>BBB Corporate Bond Yield</h3>
                    <div class="input-group">
                        <label for="bbb-change">3-Month Change (%)</label>
                        <input type="number" id="bbb-change" step="0.01" value="0" placeholder="Enter change in basis points">
                    </div>
                </div>

                <div class="control-group">
                    <h3>Stock Market Index</h3>
                    <div class="input-group">
                        <label for="stock-change">3-Month Change (%)</label>
                        <input type="number" id="stock-change" step="0.01" value="0" placeholder="Enter percentage change">
                    </div>
                </div>

                <div class="control-group">
                    <h3>House Price Index</h3>
                    <div class="input-group">
                        <label for="house-change">3-Month Change (%)</label>
                        <input type="number" id="house-change" step="0.01" value="0" placeholder="Enter percentage change">
                    </div>
                </div>

                <div class="control-group">
                    <h3>Broad Dollar Index</h3>
                    <div class="input-group">
                        <label for="dollar-change">3-Month Change (%)</label>
                        <input type="number" id="dollar-change" step="0.01" value="0" placeholder="Enter percentage change">
                    </div>
                </div>

                <div class="control-group forecast-controls">
                    <h3>Forecast Controls</h3>
                    <div class="input-group">
                        <label for="forecast-months">Forecast Months</label>
                        <input type="number" id="forecast-months" min="1" max="36" value="12" placeholder="Number of months to forecast">
                    </div>
                    <button onclick="calculateForecast()">Update Forecast</button>
                    <button class="reset-btn" onclick="resetInputs()">Reset All</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // FCI-G calculation coefficients (simplified version based on methodology)
        const COEFFICIENTS = {
            ffr: [0.09994, 0.06858, 0.05093, 0.03039],
            treasury: [0.08500, 0.05800, 0.04200, 0.02500],
            mortgage: [0.07200, 0.04900, 0.03600, 0.02100],
            bbb: [0.06800, 0.04600, 0.03400, 0.02000],
            stock: [-0.05200, -0.03500, -0.02600, -0.01500],
            house: [-0.04100, -0.02800, -0.02100, -0.01200],
            dollar: [0.03900, 0.02600, 0.01900, 0.01100]
        };

        let chart;
        let historicalData = [];
        let forecastData = [];

        async function loadData() {
            try {
                const response = await fetch('https://www.federalreserve.gov/econres/notes/feds-notes/fci_g_public_monthly_3yr.csv', {
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                
                const csvText = await response.text();
                parseCSVData(csvText);
                initializeChart();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                // Fallback to demo data
                createDemoData();
                initializeChart();
                document.getElementById('main-content').style.display = 'block';
            }
        }

        function parseCSVData(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            
            historicalData = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length >= 2) {
                    const date = new Date(values[0]);
                    const fciValue = parseFloat(values[1]);
                    
                    if (!isNaN(fciValue)) {
                        historicalData.push({
                            date: date,
                            value: fciValue,
                            raw: {
                                ffr: parseFloat(values[2]) || 0,
                                treasury: parseFloat(values[3]) || 0,
                                mortgage: parseFloat(values[4]) || 0,
                                bbb: parseFloat(values[5]) || 0,
                                stock: parseFloat(values[6]) || 0,
                                house: parseFloat(values[7]) || 0,
                                dollar: parseFloat(values[8]) || 0
                            }
                        });
                    }
                }
            }
            
            // Sort by date
            historicalData.sort((a, b) => a.date - b.date);
        }

        function createDemoData() {
            // Create demo data when real data fails to load
            historicalData = [];
            const startDate = new Date('2021-01-01');
            
            for (let i = 0; i < 36; i++) {
                const date = new Date(startDate);
                date.setMonth(date.getMonth() + i);
                
                // Generate realistic FCI-G values
                const trend = Math.sin(i * 0.2) * 0.5;
                const noise = (Math.random() - 0.5) * 0.3;
                const value = trend + noise;
                
                historicalData.push({
                    date: date,
                    value: value,
                    raw: {
                        ffr: 0, treasury: 0, mortgage: 0, bbb: 0,
                        stock: 0, house: 0, dollar: 0
                    }
                });
            }
        }

        function initializeChart() {
            const ctx = document.getElementById('fciChart').getContext('2d');
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Historical FCI-G',
                        data: historicalData.map(d => ({
                            x: d.date,
                            y: d.value
                        })),
                        borderColor: 'rgb(52, 73, 94)',
                        backgroundColor: 'rgba(52, 73, 94, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1
                    }, {
                        label: 'Forecast',
                        data: [],
                        borderColor: 'rgb(231, 76, 60)',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'FCI-G Index'
                            },
                            grid: {
                                color: function(context) {
                                    if (context.tick.value === 0) {
                                        return 'rgb(0, 0, 0)';
                                    }
                                    return 'rgba(0, 0, 0, 0.1)';
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Financial Conditions Impulse on Growth (FCI-G)'
                        },
                        legend: {
                            display: true
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(3);
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        function calculateFCI(changes) {
            let fciValue = 0;
            
            // Apply coefficients for each variable
            Object.keys(COEFFICIENTS).forEach(variable => {
                if (changes[variable] !== undefined) {
                    const change = changes[variable] / 100; // Convert percentage to decimal
                    const coeffs = COEFFICIENTS[variable];
                    
                    // Sum up the weighted impacts (simplified calculation)
                    for (let i = 0; i < coeffs.length; i++) {
                        fciValue += change * coeffs[i];
                    }
                }
            });
            
            return fciValue;
        }

        function calculateForecast() {
            const changes = {
                ffr: parseFloat(document.getElementById('ffr-change').value) || 0,
                treasury: parseFloat(document.getElementById('treasury-change').value) || 0,
                mortgage: parseFloat(document.getElementById('mortgage-change').value) || 0,
                bbb: parseFloat(document.getElementById('bbb-change').value) || 0,
                stock: parseFloat(document.getElementById('stock-change').value) || 0,
                house: parseFloat(document.getElementById('house-change').value) || 0,
                dollar: parseFloat(document.getElementById('dollar-change').value) || 0
            };
            
            const forecastMonths = parseInt(document.getElementById('forecast-months').value) || 12;
            const fciImpact = calculateFCI(changes);
            
            // Generate forecast data
            forecastData = [];
            const lastHistoricalDate = historicalData[historicalData.length - 1].date;
            const lastHistoricalValue = historicalData[historicalData.length - 1].value;
            
            for (let i = 0; i <= forecastMonths; i++) {
                const forecastDate = new Date(lastHistoricalDate);
                forecastDate.setMonth(forecastDate.getMonth() + i);
                
                // Apply the FCI impact with some decay over time
                const decayFactor = Math.exp(-i * 0.05);
                const forecastValue = lastHistoricalValue + (fciImpact * decayFactor);
                
                forecastData.push({
                    x: forecastDate,
                    y: forecastValue
                });
            }
            
            // Update chart
            chart.data.datasets[1].data = forecastData;
            chart.update();
        }

        function resetInputs() {
            document.getElementById('ffr-change').value = 0;
            document.getElementById('treasury-change').value = 0;
            document.getElementById('mortgage-change').value = 0;
            document.getElementById('bbb-change').value = 0;
            document.getElementById('stock-change').value = 0;
            document.getElementById('house-change').value = 0;
            document.getElementById('dollar-change').value = 0;
            document.getElementById('forecast-months').value = 12;
            
            // Clear forecast
            chart.data.datasets[1].data = [];
            chart.update();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>